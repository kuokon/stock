{"version":3,"file":"Controllers.js","sourceRoot":"","sources":["../../../src/ot/model/Controllers.ts"],"names":[],"mappings":"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","sourcesContent":["// import * as angular from \"angular\";\r\n\r\n\r\nmodule MyApp {\r\n\r\n\r\n    export class AdminController {\r\n\r\n        static $inject = ['DbService', '$routeParams', '$mdSidenav', '$mdToast', '$mdDialog', '$mdMedia', '$mdBottomSheet'];\r\n        title: string = 'Admin';\r\n        svr: DbService;\r\n\r\n        constructor(private DbService: DbService,\r\n                    $routeParams: any,\r\n                    private $mdSidenav: ng.material.ISidenavService,\r\n                    private $mdToast: ng.material.IToastService,\r\n                    private $mdDialog: ng.material.IDialogService,\r\n                    private $mdMedia: ng.material.IMedia,\r\n                    private $mdBottomSheet: ng.material.IBottomSheetService) {\r\n\r\n            this.svr = DbService;\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    export class OptionController {\r\n\r\n        static $inject = ['DbService', '$routeParams', '$mdSidenav', '$mdToast', '$mdDialog', '$mdMedia', '$mdBottomSheet'];\r\n        title: string = 'Option';\r\n        svr: DbService;\r\n\r\n        stats: OptionStats = new OptionStats();\r\n        isShowExpire: boolean = false;\r\n        isShowStocks: boolean = true;\r\n        filter: string;\r\n\r\n\r\n        constructor(private DbService: DbService,\r\n                    $routeParams: any,\r\n                    private $mdSidenav: ng.material.ISidenavService,\r\n                    private $mdToast: ng.material.IToastService,\r\n                    private $mdDialog: ng.material.IDialogService,\r\n                    private $mdMedia: ng.material.IMedia,\r\n                    private $mdBottomSheet: ng.material.IBottomSheetService) {\r\n\r\n            this.svr = DbService;\r\n\r\n        }\r\n\r\n        onMakeStock(): void {\r\n            let stock = Stock.fromJson(this.svr, '');\r\n\r\n            this.svr.mgr.stocks.add(stock);\r\n        }\r\n\r\n\r\n        getOptions(filter: string): Option[] {\r\n\r\n            let tmp = this.svr.mgr.options.getAll();\r\n\r\n            if (!this.isShowExpire) {\r\n                tmp = tmp.filter(e => {\r\n                    return !e.isExpired()\r\n                })\r\n            }\r\n\r\n            let res: Option[] = [];\r\n\r\n            if (!Helper.isBlank(filter)) {\r\n                for (const re of tmp) {\r\n                    if (re.match(filter)) {\r\n                        res.push(re);\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                res = tmp;\r\n            }\r\n\r\n            this.stats.calc(res);\r\n\r\n            let stocks = this.svr.mgr.stocks.getAll();\r\n            stocks.forEach(e => {\r\n                e._exposure_p = 0;\r\n                e._exposure_c = 0;\r\n                e._cash_in_amt = 0;\r\n                e._cash_lost_amt = 0;\r\n                e._num_call = 0;\r\n                e._num_put = 0;\r\n            });\r\n\r\n            res.forEach(e => {\r\n\r\n                let ep = e.getExposure();\r\n                let stock = e.getStock();\r\n                if (e.isCall()) {\r\n                    stock._exposure_c += ep;\r\n                    stock._num_call += e.NumContract;\r\n                } else {\r\n                    stock._exposure_p += ep;\r\n                    stock._num_put += e.NumContract;\r\n                }\r\n\r\n                stock._cash_in_amt += e.getCashIn();\r\n                stock._cash_lost_amt += e.getLost();\r\n\r\n            });\r\n\r\n            return res;\r\n\r\n        }\r\n\r\n\r\n        onParse(raw): ParseResult {\r\n\r\n            let isHK = false;\r\n            return Import.parseRaw(this.svr, raw, isHK);\r\n        }\r\n\r\n        getSubheaders(): NV[] {\r\n            return [\r\n                {name: 'main', value: '/'}\r\n                , {name: 'import', value: '/option/'}\r\n            ]\r\n        }\r\n\r\n        onCopyDataToClipboard(options: Option[]): void {\r\n\r\n            //let res :Option[] = pr.parsed;\r\n            let buf = JSON.stringify(options, Helper.json_replacer);\r\n            Helper.copyTxtToClipboard(this.svr, buf);\r\n\r\n\r\n        }\r\n\r\n        refreshStockPrice(): void {\r\n\r\n            let stocks = this.svr.mgr.stocks.getAll();\r\n            stocks.forEach(e => {\r\n                this.getStockPrice(e);\r\n            })\r\n\r\n        }\r\n\r\n        getStockPrice(stock: Stock): number {\r\n\r\n\r\n            let symbol = 'goog';\r\n            let apikey = '4VDN7RLHYUFKHWXE';\r\n\r\n\r\n            symbol = stock.Symbol + (stock.isHK() ? '.HK' : '' );\r\n\r\n            //let url = 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=IBM&apikey=demo';\r\n            let url = 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=' + symbol + '&apikey=' + apikey;\r\n\r\n            // console.info(' ')\r\n\r\n            this.svr.$http.get(url).then(res => {\r\n                console.info(' res: ' + JSON.stringify(res));\r\n                console.info(' curr price for ' + symbol + ' ==> ' + res.data);\r\n\r\n                let price , last;\r\n\r\n                try {\r\n\r\n                    price = res.data['Global Quote']['05. price'];\r\n                    last = res.data['Global Quote']['08. previous close'];\r\n                    // change = res.data['Global Quote']['09. change'];\r\n                    // change_pct = res.data['Global Quote']['10. change percent'];\r\n\r\n                    stock.Price = parseFloat(price);\r\n                    stock.PriceLast = parseFloat(last);\r\n\r\n\r\n                    console.info(' price updated ' + stock.Symbol + ' --> ' + stock.Price);\r\n                } catch (e) {\r\n                    console.error(e);\r\n                }\r\n\r\n            });\r\n\r\n            return 100;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}